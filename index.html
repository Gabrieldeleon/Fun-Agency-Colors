<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Asignador de Equipos</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3em;
      color: white;
      font-family: sans-serif;
    }
  </style>
</head>
<body id="body">
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxLRB5Jdc-d6VHxM1WzJoIOqLZH6-BTco3VgdfIbtQZE08TTYT-3mIYyixgmspmhVfN/exec"; // Pega aquí el URL de tu Apps Script
    

    async function getConfig() {
      const res = await fetch(`${API_URL}?action=getConfig`);
      return res.json();
    }

    async function getPersonas() {
      const res = await fetch(`${API_URL}?action=getPersonas`);
      return res.json();
    }

    async function addPersona(id, nombre, color) {
      await fetch(`${API_URL}?action=addPersona&id=${id}&nombre=${nombre}&color=${color}`);
    }

    function generateId() {
      return Math.random().toString(36).substr(2, 9);
    }

    async function main() {
      let id = localStorage.getItem("personaId");
      let colorAsignado = null;

      const config = await getConfig();
      const personas = await getPersonas();

      if (id) {
        const persona = personas.find(p => p.id === id);
        if (persona) {
          colorAsignado = persona.color;
        }
      }

      if (!colorAsignado) {
        id = generateId();
        localStorage.setItem("personaId", id);

        // Contar cuántas personas hay en cada color
        const conteo = {};
        config.colores.forEach(c => conteo[c] = 0);
        personas.forEach(p => {
          if (conteo[p.color] !== undefined) conteo[p.color]++;
        });

        // Buscar color con menos personas
        let minColor = config.colores[0];
        for (const c of config.colores) {
          if (conteo[c] < conteo[minColor]) minColor = c;
        }

        colorAsignado = minColor;
        await addPersona(id, "", colorAsignado);
      }

      document.body.style.background = colorAsignado;
      document.body.innerText = colorAsignado;
    }

    main();
  </script>
</body>
</html>
