<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tu Equipo | Fun Agency</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }
      .wrap {
        min-height: 35%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 24px;
      }
      .card {
        background: rgba(255,255,255,0.14);
        border-radius: 20px;
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        padding: 28px 32px;
        max-width: 720px;
        width: 100%;
        box-shadow: 0 8px 30px rgba(0,0,0,0.18);
        border: 1px solid rgba(255, 255, 255, 0.2);

      }
      h1 {
        font-size: clamp(42px, 7vw, 80px);
        line-height: 1.05;
        margin: 0 0 12px 0;
        letter-spacing: -0.02em;
      }
      p {
        margin: 0.5rem 0;
        font-size: clamp(16px, 2.6vw, 22px);
        opacity: 0.9;
      }
      .muted { 
        opacity: 0.75; 
        font-size: 14px; 
      }
      .loading {
        animation: pulse 2s infinite;
      }
      .wrap.logo {
        min-height:30%;
      }
      .logo img {
        height:150px;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      footer {
          backdrop-filter: blur(10px);
          padding-top: 3rem;
          display: flex;
          justify-content: center;
          align-items: center;
      }
      .footer-links {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
          align-items: center;
      }
      .footer-link {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          text-decoration: none;
          color: white;
          font-size: 1.1rem;
          font-weight: 500;
          padding: 0.75rem 1.5rem;
          border-radius: 50px;
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.2);
          transition: all 0.3s ease;
          backdrop-filter: blur(5px);
          min-width: 200px;
          justify-content: center;
      }      
      .footer-link:hover {
          background: rgba(255, 255, 255, 0.2);
          border-color: rgba(255, 255, 255, 0.4);
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      }      
      .footer-link svg {
          width: 24px;
          height: 24px;
          transition: transform 0.3s ease;
      }      
      .footer-link:hover svg {
          transform: scale(1.1);
      }      
      .facebook-link:hover {
          background: rgba(0, 0, 0, 0.2);
      }      
      .website-link:hover {
          background: rgba(0, 0, 0, 0.2);
      }      
      @media (max-width: 480px) {
          .footer-link {
              min-width: 180px;
              font-size: 1rem;
              padding: 0.6rem 1.2rem;
          }          
          .footer-link svg {
              width: 20px;
              height: 20px;
          }
      }
    </style>
  </head>
  <body>
    <div class="wrap logo">
      <img src="img/fa_logo.png" alt="Fun Agency logo">
    </div>
    <div class="wrap">
      <div class="card">
        <h1 id="teamTitle" class="loading">Asignando…</h1>
        <p id="teamHint">Espera un segundo</p>
        <p class="muted" id="footnote"></p>
      </div>
    </div>
    <footer>
            <div class="footer-links">
                <a href="https://www.facebook.com/funagencypr/" class="footer-link facebook-link" target="_blank" rel="noopener noreferrer">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    Síguenos en Facebook
                </a>
                
                <a href="https://funagencypr.com" class="footer-link website-link" target="_blank" rel="noopener noreferrer">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                    Visita nuestro Website
                </a>
            </div>
        </footer>

  <script>
  (async function(){
    const colorMap = {
      'Rojo': '#e53935',
      'Azul': '#1e88e5',
      'Verde': '#43a047',
      'Amarillo': '#fdd835',
      'Naranja': '#fb8c00',
      'Morado': '#8e24aa',
      'Gris': '#9e9e9e'
    };

    function idealTextColor(bgHex){
      function hexToRgb(h){
        let s = h.replace('#','');
        if (s.length === 3) s = s.split('').map(x=>x+x).join('');
        const num = parseInt(s, 16);
        return {r:(num>>16)&255, g:(num>>8)&255, b:num&255};
      }
      const {r,g,b} = hexToRgb(bgHex);
      const yiq = (r*299 + g*587 + b*114) / 1000;
      return yiq >= 140 ? '#000' : '#fff';
    }

    // Generate a unique user ID based on browser and time
    function generateUserId() {
      const stored = localStorage.getItem('teamAppUserId');
      if (stored) return stored;
      
      const id = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('teamAppUserId', id);
      return id;
    }

    // Replace with your actual Apps Script URL
    const apiUrl = "https://script.google.com/macros/s/AKfycbxCR0peJ-9Vf2j9ZAY7RY7neahvUpuyOXrWBxiPHDvvNhzqfDRP94slEnSTT4-bdKI/exec";

    try {
      const userId = generateUserId();
      
      // First, try to get existing assignment
      const checkResponse = await fetch(`${apiUrl}?action=getPersona&id=${encodeURIComponent(userId)}`);
      
      let assignedColor = null;
      
      if (checkResponse.ok) {
        const checkData = await checkResponse.json();
        if (checkData.color && !checkData.error) {
          assignedColor = checkData.color;
        }
      }
      
      // If no existing assignment, request a new one
      if (!assignedColor) {
        const assignResponse = await fetch(`${apiUrl}?action=assignColor&id=${encodeURIComponent(userId)}`);
        
        if (!assignResponse.ok) {
          throw new Error(`HTTP error! status: ${assignResponse.status}`);
        }
        
        const assignData = await assignResponse.json();
        
        if (assignData.error) {
          throw new Error(assignData.error);
        }
        
        assignedColor = assignData.color;
      }
      
      if (!assignedColor) {
        throw new Error('No se pudo obtener el color asignado');
      }

      // Apply the color theme
      const bgColor = colorMap[assignedColor] || "#9e9e9e";
      const textColor = idealTextColor(bgColor);

      document.body.style.background = bgColor;
      document.body.style.color = textColor;
      document.getElementById("teamTitle").textContent = "Tu equipo: " + assignedColor;
      document.getElementById("teamTitle").classList.remove("loading");
      document.getElementById("teamHint").textContent = "Muestra esta pantalla al Fun Agent";
      document.getElementById("footnote").textContent = "ID: " + userId.substr(-8);

    } catch (err) {
      console.error("Error fetching color:", err);
      document.getElementById("teamTitle").textContent = "Error";
      document.getElementById("teamTitle").classList.remove("loading");
      document.getElementById("teamHint").textContent = "No se pudo obtener el color: " + err.message;
      document.getElementById("footnote").textContent = "Intenta recargar la página";
    }
  })();
  </script>
  </body>
</html>
